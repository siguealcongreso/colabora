{% extends "base.html" %}
{% block title %}Iniciativas asignadas - Legislatura LXIII{% endblock %}
{% block content %}
    <div class="container">
      <p>
	{% if g.user %}
	&nbsp;
	{% if g.user['rol'] == 'admin' and request.path != '/desasigna' %}
	<a class="btn btn-outline-primary" href="desasigna">Desasignar iniciativas</a>
	{% endif %}
	{% if request.path == '/desasigna' %}
	<a class="btn btn-outline-primary" href=".">Ver mis asignadas</a>
	{% endif %}
	{% if request.path in ('/', '/desasigna') and g.user['rol'] != 'escritor' %}
	<a class="btn btn-outline-primary" href="iniciativas">Ver todas las iniciativas</a>
	{% endif %}
	{% if request.path == '/iniciativas' %}
	<a class="btn btn-outline-primary" href=".">Ver mis asignadas</a>
	{% endif %}
	<a class="btn btn-outline-primary float-end" href="logout">Terminar sesi√≥n</a>
	<a class="btn btn-outline-primary float-end" href="usuario">Usuario: {{ g.user['usuario'] }}</a>
	{% else %}
	<a class="btn btn-outline-primary" href="login">Iniciar sesi√≥n</a>
	<a class="btn btn-outline-primary" href="registro">Registrar nuevo usuario</a>
	{% endif %}
      </p>
	{% if request.path == '/desasigna' %}
	<form class="needs-validation" novalidate method="post">
        <button class="btn btn-secondary" type="submit">Desasignar</button>
  <div class="container">
    <section class="section">
      <table class="table table-hover" id="asignadas">
        <thead>
            <tr class="tl">
                <th>Usuario</th>
                <th>Cantidad</th>
                <th>Nuevas</th>
                <th>Pendientes</th>
                <th>Revisadas</th>
            </tr>
        </thead>
        <tbody>
            {% for user in users | sort(attribute='usuario') %}
            <tr>
                <td>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="autor" value="{{ user.usuario }}" id="id{{ user.usuario }}" required>
                        <label class="form-check-label" for="id{{ user.usuario }}">{{ user.usuario }}</label>
                        {% if loop.last %}
                        <div class="valid-feedback">Ok</div>
                        <div class="invalid-feedback">Selecciona un usuario</div>
                        {% endif %}
                    </div>
                </td>
                <td>{{ asignadas.get(user.usuario, {'Total':0})['Total'] }}</td>
                <td>{{ asignadas.get(user.usuario, {'Nueva':0})['Nueva'] }}</td>
                <td>{{ asignadas.get(user.usuario, {'Pendiente':0})['Pendiente'] }}</td>
                <td>{{ asignadas.get(user.usuario, {'Revisada':0})['Revisada'] }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>    
      </div>
	{{ asignadas['']['Total'] }} por asignar
	{% endif %}
    <h3 class="alert alert-danger">Favor de usar con cuidado.</h2>
    </div>
    {% for usuario, iniciativas_user in iniciativas_por_usuario.items() | sort%}
    <div class="container">
        <h2 id="h{{ loop.index }}">{{ usuario }} - {{ iniciativas_user|length }}</h2>
    </div>
    {% for r in iniciativas_user %}
    <div class="container px-4">
      <div class="row py-2 bg-light border-bottom-0 border">
        <div class="col-md-3">
          <div class=""><b>N√∫mero</b> {{ r.numero }}
          </div>
        </div>
        <div class="col-md-3">
          <div class="form-check">
            <input class="form-check-input" type="checkbox" name="numero" value="{{ r.numero }}" id="c{{ r.numero }}" {% if r.estado != None %}disabled{% endif %}>
            <label class="form-check-label" for="c{{ r.numero }}"><b>Desasignar</b></label>
            <div class="valid-feedback">Ok</div>
            <div class="invalid-feedback">Selecciona una o m√°s iniciativas</div>
          </div>
        </div>
        <div class="col-md-6">
          <div class=""><b>Estado</b> {% if r.estado != None %}{{ r.estado }}{% endif %}
          </div>
        </div>
      </div>
      <div class="row py-2 border border-top-0 bg-light">
        <div class="">
          <div class="">
              <b>Cambios</b> {{ r.cambios }}
                (<a href="https://siguealcongreso.org/monitoreo/iniciativas/lxiii/{{ r.numero }}/" title="Ver ficha">{{ r.numero }}</a>)
            <a href="https://congresoweb.congresojal.gob.mx/infolej/sistemaintegral/infolej/{{ r.documento }}" target="_blank" title="Leer el documento">üñπ</a>
            {% if g.user and (r.usuario == g.user['usuario'] or g.user['rol'] in ('editor', 'admin')) %}
	    <a href="edita/{{ r.numero }}" title="Editar">‚úè</a>
	    {% endif %}
          </div>
        </div>
      </div>
      <div class="row py-2 border border-top-0 bg-light">
          <div class="col-md-3">
            <div class=""><b>Tema</b>
	      {% for t in temas[r.numero] %}
	      {{ t }}<br>
	      {% endfor %}
            </div>
          </div>
          <div class="col-md-6">
            <div class=""><b>Resumen</b>
	      {% for r in resumenes[r.numero] %}
	      {{ r }}<br>
	      {% endfor %}
            </div>
          </div>
          <div class="col-md-3">
            <div class=""><b>√Årea</b>
              {% for area in tags[r.numero] %}
               {{ area }}
              {% endfor %}
            </div>
          </div>
      </div>
      <div class="row py-2 border border-top-0 bg-light">
        <div class=""><b>Comentario</b>
	      {% for c in comentarios[r.numero] %}
	      {{ c }}<br>
	      {% endfor %}
        </div>
      </div>
    </div>
</div>
</div>
<br>
</div>
{% endfor %}
{% endfor %}
      </form>
{% endblock %}
